{
  "codex_memory": {
    "project": "Finance App Project",
    "version": "v5.7 (An√°lise de Seguran√ßa e Resili√™ncia Integrada)",
    "description": "Fullstack personal finance manager (React + Express + Prisma + MongoDB + RabbitMQ). Foco em robustez, seguran√ßa e modulariza√ß√£o.",
    "milestones": [
      {
        "id": 1,
        "tag": "[BUG] Replica√ß√£o e idempot√™ncia",
        "status": "üü¢ Resolvido",
        "notes": "Index de fingerprint √∫nico criado. Script backfill ajustado com gera√ß√£o via generateFingerprint()."
      },
      {
        "id": 2,
        "tag": "[DB] Float ‚Üí String precision",
        "status": "üü¢ Conclu√≠do",
        "notes": "Campos amount/sharedAmount/limit migrados para String com coer√ß√£o em helpers."
      },
      {
        "id": 3,
        "tag": "[API] Security & Config ENV",
        "status": "üü¢ Conclu√≠do",
        "summary": "Adicionados Helmet, CORS din√¢mico e valida√ß√£o de ENVs com Zod.",
        "notes": [
          "Criado backend/src/config.ts com valida√ß√£o Zod para PORT, DATABASE_URL, JWT_SECRET, RABBIT_URL e CORS_ORIGIN.",
          "Atualizado backend/src/index.ts para usar config.ts, aplicar helmet() e CORS din√¢mico.",
          "Adicionadas depend√™ncias helmet, zod e @types/helmet no backend/package.json.",
          "Servidor agora falha no boot se vari√°veis obrigat√≥rias estiverem ausentes, garantindo seguran√ßa e previsibilidade."
        ]
      },
      {
        "id": 4,
        "tag": "[Worker] RabbitMQ Robustness",
        "status": "üü¢ Conclu√≠do",
        "notes": "Reconex√£o com backoff, prefetch(10), ConfirmChannel e graceful shutdown (SIGINT/SIGTERM)."
      },
      {
        "id": 5,
        "tag": "[API] √çndices e filtros UTC",
        "status": "üü¢ Implementado",
        "notes": "Expense model agora com @@index([userId, date]); consultas ajustadas para monthStart/monthEnd com Date.UTC."
      },
      {
        "id": 6,
        "tag": "[FE] MUI Only Theme",
        "status": "üü° Planejado",
        "notes": "Removendo classes Tailwind remanescentes, consolidando ThemeProvider centralizado (palette + typography)."
      },
      {
        "id": 7,
        "tag": "[FE] Hooks Tipados + Query Cache",
        "status": "üü° Planejado",
        "summary": "Dividir 'useFinanceApp' e adotar TanStack Query, implementando uma camada de servi√ßo de API.",
        "notes": [
          "Refatorar 'useFinanceApp' em hooks menores (useExpenses, useCatalogs, useSalary).",
          "Adotar TanStack Query para cache, 'refetch' e 'invalidation'.",
          "Implementar Camada de API Dedicada (Sugest√£o 3.1): Criar 'frontend/src/services/api.ts' (com 'axios.create' e 'withCredentials') e 'frontend/src/services/expenseService.ts'.",
          "Implementar Gerenciamento de Query Keys (Sugest√£o 3.2): Criar 'frontend/src/lib/queryKeys.ts' para centralizar e evitar 'magic strings' nas chaves do TanStack Query."
        ]
      },
      {
        "id": 8,
        "tag": "[FE] Navega√ß√£o mensal",
        "status": "üü° Planejado",
        "notes": "Adicionar setas de navega√ß√£o prev/next ao Dashboard com anima√ß√£o suave."
      },
      {
        "id": 9,
        "tag": "[FE] Toasts & Empty States",
        "status": "üü° Planejado",
        "notes": "Integrar 'notistack' para feedbacks de CRUD (create, update, delete) e placeholders visuais em listas vazias."
      },
      {
        "id": 10,
        "tag": "[DX] Healthchecks e Docker Prod",
        "status": "üü° Planejado",
        "notes": "Criar 'health:db', 'healthcheck' no 'docker-compose.yml' e otimiza√ß√£o multi-stage builds (non-root, npm ci, prune)."
      },
      {
        "id": 11,
        "tag": "[Security] Valida√ß√£o de Rota (Zod)",
        "status": "üü° Planejado (NOVO)",
        "notes": [
          "Implementar Zod para valida√ß√£o de 'req.body', 'req.query' e 'req.params' em TODAS as rotas (Sugest√£o 1.1).",
          "Criar diret√≥rio 'backend/src/schemas/' para centralizar os schemas (ex: 'expense.schema.ts').",
          "Criar um middleware de valida√ß√£o reutiliz√°vel."
        ]
      },
      {
        "id": 12,
        "tag": "[Security] Rate Limiting",
        "status": "üü° Planejado (NOVO)",
        "notes": [
          "Implementar 'express-rate-limit' para proteger contra ataques de for√ßa bruta e DoS (Sugest√£o 1.2).",
          "Criar um 'authLimiter' estrito (ex: 10 reqs/10 min) para '/api/auth/login' e '/api/auth/register'.",
          "Criar um 'apiLimiter' geral (ex: 100 reqs/15 min) para as demais rotas '/api/*'."
        ]
      },
      {
        "id": 13,
        "tag": "[Security] Auth httpOnly Cookies",
        "status": "üü° Planejado (NOVO)",
        "notes": [
          "Refatorar a estrat√©gia de autentica√ß√£o para parar de usar 'localStorage' para o JWT (Sugest√£o 1.3).",
          "Backend: Na rota de login, enviar o token via 'res.cookie(..., { httpOnly: true, secure: true, sameSite: 'strict' })'.",
          "Backend: Criar rota '/api/auth/logout' que limpa o cookie.",
          "Frontend: Configurar 'axios.defaults.withCredentials = true' no 'api.ts' (Milestone 7)."
        ]
      },
      {
        "id": 14,
        "tag": "[Resilience] Dead Letter Queue (DLQ)",
        "status": "üü° Planejado (NOVO)",
        "notes": [
          "Implementar o padr√£o Dead Letter Queue no RabbitMQ para tratar mensagens 'envenenadas' (Sugest√£o 2.1).",
          "Configurar a fila 'recurring-jobs' com 'deadLetterExchange'.",
          "Atualizar l√≥gica do 'recurringWorker.ts': usar 'channel.nack(msg, false, false)' em erros permanentes (ex: JSON.parse error) para mover a msg para a DLQ."
        ]
      },
      {
        "id": 15,
        "tag": "[Refactor] Service/Repository Layer",
        "status": "üü° Planejado (NOVO)",
        "notes": [
          "Refatorar o backend para uma arquitetura de 3 camadas (Sugest√£o 2.2).",
          "1. 'src/routes/': Apenas valida√ß√£o (Zod) e chamada de servi√ßo.",
          "2. 'src/services/': Toda a l√≥gica de neg√≥cio (c√°lculos, permiss√µes).",
          "3. 'src/repositories/': A √∫nica camada que importa e usa 'prisma'."
        ]
      },
      {
        "id": 16,
        "tag": "[DX] Testes Automatizados",
        "status": "üü° Planejado (NOVO)",
        "notes": [
          "Introduzir 'vitest' no projeto (Sugest√£o 4.1).",
          "Backend: Testes unit√°rios para a camada de 'services' (mockando o reposit√≥rio) e testes de integra√ß√£o para as rotas (usando 'supertest').",
          "Frontend: Testes de componentes com React Testing Library (RTL) e testes de hooks."
        ]
      },
      {
        "id": 17,
        "tag": "[DX] Storybook",
        "status": "üü° Planejado (NOVO)",
        "notes": "Adicionar Storybook ao frontend para desenvolver e documentar componentes de UI (MUI) em isolamento (Sugest√£o 4.2)."
      }
    ],
    "last_action": "An√°lise de seguran√ßa e resili√™ncia (finance_app_review.md) conclu√≠da e mesclada ao plano de projeto.",
    "next_steps": [
      "Priorizar e iniciar os Milestones de Seguran√ßa (11, 12, 13) que s√£o cr√≠ticos.",
      "Continuar o trabalho no Milestone 3 (Valida√ß√£o de ENV com Zod).",
      "Ap√≥s a seguran√ßa da API, focar no refactor do Frontend (Milestone 7)."
    ],
    "commit_template": "‚Ä¢ [Feature/Refactor/Fix] Descri√ß√£o da mudan√ßa.\n‚Ä¢ Relacionado ao(s) Milestone(s): #[ID]"
  }
}
